package com.tn3270.ai;

import java.io.*;
import java.util.Arrays;
import java.util.Properties;

public class AIConfig {
    private final Properties props = new Properties();
    private final File file;

    public AIConfig(String path) {
        this.file = new File(path);
        load();
    }

    public void load() {
        try {
            props.clear();
            if (file.exists())
                try (FileInputStream fis = new FileInputStream(file)) {
                    props.load(fis);
                }
        } catch (Exception e) {
            System.err.println("AIConfig.load: " + e.getMessage());
        }
    }

    public String get(String key, String def) {
        return props.getProperty(key, def);
    }

    public boolean getBoolean(String key, boolean def) {
        String v = props.getProperty(key);
        if (v == null)
            return def;
        return "true".equalsIgnoreCase(v) || "1".equals(v);
    }

    public String[] getModels() {
        String m = props.getProperty("ai.models");
        if (m == null)
            return new String[] { "gpt-4o-mini", "gpt-4o" };
        return Arrays.stream(m.split(",")).map(String::trim).filter(s -> !s.isEmpty()).toArray(String[]::new);
    }

    public String getProvider() {
        return props.getProperty("ai.provider", "openai");
    }

    public String getApiKey() {
        return props.getProperty("ai.apiKey", "");
    }

    public String getEndpoint() {
        return props.getProperty("ai.endpoint", "http://localhost:11434");
    }

    public void put(String k, String v) {
        props.setProperty(k, v);
    }

    public void save() throws IOException {
        try (FileOutputStream fos = new FileOutputStream(file)) {
            props.store(fos, "ai.conf");
        }
    }

    public File file() {
        return file;
    }

    public Properties props() {
        return props;
    }
}
